version: "3.8"
services:
  node_test:
    build:
      context: ./
      dockerfile: Dockerfile.node
    volumes:
      - ./hathor/nanocontracts/blueprints:/app/hathor/nanocontracts/blueprints
      - ./hathor/conf/nano_testnet.yml:/app/hathor/conf/nano_testnet.yml
      - ./tests:/app/tests
      - ./.git:/app/.git
    environment:
      - GIT_DISCOVERY_ACROSS_FILESYSTEM=1
      - HATHOR_TEST_DISABLE_GIT=1

    # command: ["poetry", "run", "pytest","-rP", "hathor/tests/nanocontracts/blueprints/test_rewards.py"] # with stdout
    # command: [
    #     "poetry",
    #     "run",
    #     "pytest",
    #     "--capture=no",
    #     "--disable-warnings",
    #     "--tb=short",           # shorter but readable tracebacks on failure
    #     "--color=yes",          # colorized output
    #     "-q",                   # quiet mode - only show failures and summary
    #     "tests/nanocontracts/blueprints/test_dozer_temp.py",
    #   ]

    command:
      [
        "poetry",
        "run",
        "hathor-cli",
        "check-blueprint",
        "--file",
        "hathor/nanocontracts/blueprints/dozer_pool_manager.py",
      ]
